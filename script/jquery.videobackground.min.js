/*!
 * jQuery Video Background plugin
 * https://github.com/georgepaterson/jquery-videobackground
 *
 * Copyright 2012, George Paterson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */
(function(f,h,g){function a(k){var l=f(h).height(),m=f(g).height();if(k.settings.resizeTo==="window"){f(k).css("height",m)}else{if(m>=l){f(k).css("height",m)}else{f(k).css("height",l)}}}function i(k){f(k.controlbox).append(k.settings.preloadHtml);if(k.settings.preloadCallback){(k.settings.preloadCallback).call(k)}}function c(m){var l=m.find("video").get(0),k;if(m.settings.controlPosition){k=f(m.settings.controlPosition).find(".ui-video-background-play a")}else{k=m.find(".ui-video-background-play a")}if(l.paused){l.play();k.toggleClass("ui-icon-pause ui-icon-play").text(m.settings.controlText[1])}else{if(l.ended){l.play();k.toggleClass("ui-icon-pause ui-icon-play").text(m.settings.controlText[1])}else{l.pause();k.toggleClass("ui-icon-pause ui-icon-play").text(m.settings.controlText[0])}}}function d(m){var l=m.find("video").get(0),k;if(m.settings.controlPosition){k=f(m.settings.controlPosition).find(".ui-video-background-mute a")}else{k=m.find(".ui-video-background-mute a")}if(l.volume===0){l.volume=1;k.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(m.settings.controlText[2])}else{l.volume=0;k.toggleClass("ui-icon-volume-on ui-icon-volume-off").text(m.settings.controlText[3])}}function j(k){if(k.settings.resize){f(g).on("resize",function(){a(k)})}k.controls.find(".ui-video-background-play a").on("click",function(l){l.preventDefault();c(k)});k.controls.find(".ui-video-background-mute a").on("click",function(l){l.preventDefault();d(k)});if(k.settings.loop){k.find("video").on("ended",function(){f(this).get(0).play();f(this).toggleClass("paused").text(k.settings.controlText[1])})}}function e(k){f(k.controlbox).html(k.controls);j(k);if(k.settings.loadedCallback){(k.settings.loadedCallback).call(k)}}var b={init:function(k){return this.each(function(){var o=f(this),n="",m="",p=o.data("video-options"),q,l;if(h.createElement("video").canPlayType){o.settings=f.extend(true,{},f.fn.videobackground.defaults,p,k);if(!o.settings.initialised){o.settings.initialised=true;if(o.settings.resize){a(o)}f.each(o.settings.videoSource,function(){l=Object.prototype.toString.call(this)==="[object Array]";if(l&&this[1]!==undefined){n=n+'<source src="'+this[0]+'" type="'+this[1]+'">'}else{if(l){n=n+'<source src="'+this[0]+'">'}else{n=n+'<source src="'+this+'">'}}});m=m+'preload="'+o.settings.preload+'"';if(o.settings.poster){m=m+' poster="'+o.settings.poster+'"'}if(o.settings.autoplay){m=m+' autoplay="autoplay"'}if(o.settings.loop){m=m+' loop="loop"'}f(o).html("<video "+m+">"+n+"</video>");o.controlbox=f('<div class="ui-video-background ui-widget ui-widget-content ui-corner-all"></div>');if(o.settings.controlPosition){f(o.settings.controlPosition).append(o.controlbox)}else{f(o).append(o.controlbox)}o.controls=f('<ul class="ui-video-background-controls"><li class="ui-video-background-play"><a class="ui-icon ui-icon-pause" href="#">'+o.settings.controlText[1]+'</a></li><li class="ui-video-background-mute"><a class="ui-icon ui-icon-volume-on" href="#">'+o.settings.controlText[2]+"</a></li></ul>");if(o.settings.preloadHtml||o.settings.preloadCallback){i(o);o.find("video").on("canplaythrough",function(){if(o.settings.autoplay){o.find("video").get(0).play()}e(o)})}else{o.find("video").on("canplaythrough",function(){if(o.settings.autoplay){o.find("video").get(0).play()}e(o)})}o.data("video-options",o.settings)}}else{o.settings=f.extend(true,{},f.fn.videobackground.defaults,p,k);if(!o.settings.initialised){o.settings.initialised=true;if(o.settings.poster){q=f('<img class="ui-video-background-poster" src="'+o.settings.poster+'">');o.append(q)}o.data("video-options",o.settings)}}})},play:function(k){return this.each(function(){var l=f(this),m=l.data("video-options");l.settings=f.extend(true,{},m,k);if(l.settings.initialised){c(l);l.data("video-options",l.settings)}})},mute:function(k){return this.each(function(){var l=f(this),m=l.data("video-options");l.settings=f.extend(true,{},m,k);if(l.settings.initialised){d(l);l.data("video-options",l.settings)}})},resize:function(k){return this.each(function(){var l=f(this),m=l.data("video-options");l.settings=f.extend(true,{},m,k);if(l.settings.initialised){a(l);l.data("video-options",l.settings)}})},destroy:function(k){return this.each(function(){var l=f(this),m=l.data("video-options");l.settings=f.extend(true,{},m,k);if(l.settings.initialised){l.settings.initialised=false;if(h.createElement("video").canPlayType){l.find("video").off("ended");if(l.settings.controlPosition){f(l.settings.controlPosition).find(".ui-video-background-mute a").off("click");f(l.settings.controlPosition).find(".ui-video-background-play a").off("click")}else{l.find(".ui-video-background-mute a").off("click");l.find(".ui-video-background-play a").off("click")}f(g).off("resize");l.find("video").off("canplaythrough");if(l.settings.controlPosition){f(l.settings.controlPosition).find(".ui-video-background").remove()}else{l.find(".ui-video-background").remove()}f("video",l).remove()}else{if(l.settings.poster){l.find(".ui-video-background-poster").remove()}}l.removeData("video-options")}})}};f.fn.videobackground=function(k){if(!this.length){return this}if(b[k]){return b[k].apply(this,Array.prototype.slice.call(arguments,1))}if(typeof k==="object"||!k){return b.init.apply(this,arguments)}f.error("Method "+k+" does not exist on jQuery.videobackground")};f.fn.videobackground.defaults={videoSource:[],poster:null,autoplay:true,preload:"auto",loop:false,controlPosition:null,controlText:["Play","Pause","Mute","Unmute"],resize:true,preloadHtml:"",preloadCallback:null,loadedCallback:null,resizeTo:"document"}}(jQuery,document,window));